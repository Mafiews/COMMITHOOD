
<!-- yizhu: banner part -->
<%= render 'shared/navbar-home' %>
<div class="banner-hood d-flex align-items-center" style="background-image: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url('https://images.unsplash.com/photo-1525026198548-4baa812f1183?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=crop&w=1533&q=80')">
<div class="container title-info">
  <div class="row justify-content-center">
    <div class="col-10">
      <!-- site title info -->
      <div class="app-title">
        <h1 class="mt-5">Commit'hood</h1>
        <h3 class="mt-3">Engagez-vous √† deux pas de chez vous !</h3>
        <!-- <h3>Use your free time wisely to do something meaningful!</h3> -->
      </div>
        <div class="search-bar mt-5">
        <%= form_tag events_path, method: "get" do %>
          <div class="search-select col-5">
            <%= select_tag :user_cause, options_for_select(Cause::CAUSES), class: 'select2', :multiple => true %>
          </div>
          <%= text_field_tag :address, "", required: false, id: "event-address", label: false, placeholder: "Votre adresse", class: 'mr-3' %>
          <%= submit_tag "Rechercher üîç", class: "btn btn-success text-white ml-3" %>
        <% end %>
        </div>
      </div>
      <!-- site title info end -->
    </div>
  </div>
</div>

<div class="container event-cards mt-3" id="event-recos">
  <h3 class="my-4">Un peu d'inspiration üí≠</h3>
</div>

    <!-- Matt : bootstrap carousel -->
    <div id="carouselExampleIndicators" class="carousel slide carousel-card-home" data-ride="carousel">
      <ol class="carousel-indicators">
        <% i = 0 %>
        <% Event.all.each do |event| %>
          <li data-target="#carouselExampleIndicators" data-slide-to="<%= i %>" class="<%= i == 0 ? 'active' : ''%>"></li>
          <% i = i + 1 %>
        <% end %>
      </ol>
      <div class="carousel-inner">
        <% j = 0  %>
        <% Event.all.each do |event| %>
          <div class="carousel-item <%= j == 0 ? 'active' : ''%>">
            <div class="card-event-dashboard" style="margin: auto; height: 650px; width: 900px;">
              <div class="card-event-cover">
                <%= cl_image_tag event.photo.key, alt: "event photo", class:"card-event-img",crop: :fill %>
              </div>

              <div class="card-event-infos-dashboard card-event-info-home">

                <div class="d-flex align-self-stretch content-info-home">

                  <!-- Date column -->
                  <div class="card-event-date col-2 text-center">
                    <% if event.ngo.photo.attached? %>
                      <%= cl_image_tag event.ngo.photo.key, class: "avatar-event-card avatar-home" %>
                    <% end %>
                    <p><%= I18n.l(event.start_date, locale: :fr, format: :day_week) %></p>
                    <p class="event-day-highlight"><%= I18n.l(event.start_date, locale: :fr, format: :day) %></p>
                    <p><%= I18n.l(event.start_date, locale: :fr, format: :month).upcase %></p>
                    <p id="card-event-hour"><%= I18n.l(event.start_date, locale: :fr, format: :hours) %></p>
                  </div>

                  <!-- Infos column -->
                  <div class="card-event-details col-sm-7">
                    <%= link_to event.ngo.name, ngo_path(event.ngo), id: "card-event-ngo" %>
        <!--             <p id="card-event-ngo"><%= event.ngo.name %></p> -->
                    <h2><%= event.name %></h2>
                    <p><i class="fas fa-map-marker-alt"></i> <%= event.address %></p>
                    <p><i class="fas fa-user-circle"></i> <%= event.seats_left %> b√©n√©voles souhait√©s</p>
                    <!-- Day counter -->
                    <% if event.start_date > DateTime.now %>
                      <p><i class="far fa-calendar-alt"></i> commence dans <%= ((event.start_date - DateTime.now) / 1.day).to_i %> jours</p>
                    <% elsif event.end_date > DateTime.now %>
                      <p><i class="far fa-calendar-alt"></i> termine dans <%= ((event.end_date - DateTime.now) / 1.day).to_i %> jours</p>
                    <% else %>
                      <br>
                    <% end %>
                    <br>
                    <%= event.description %>
                  </div>

                  <!-- Button -->
                  <% if event.end_date < DateTime.now %>
                    <%= link_to event_path(event) do %>
                      <button class="btn btn-secondary card-btn-home">Termin√©</button>
                    <% end %>
                  <% elsif user_signed_in? == false %>
                    <%= link_to "Je participe!", event_participations_path(event), method: :post, id: "register-link", class: "btn btn-success card-btn-home" %>
                  <% elsif current_user.participations.find_by(event_id: event.id) %>
                    <%= link_to event_path(event) do %>
                      <button class="btn btn-warning card-btn-home">D√©j√† inscrit</button>
                    <% end %>
                  <% elsif event.seats_left.zero? %>
                    <%= link_to event_path(event) do %>
                      <button class="btn btn-danger my-2 card-btn-home">Complet</button>
                    <% end %>
                  <% elsif current_user %>
                    <%= link_to event_participations_path(event), method: :post, id: "register-link", remote: true, class: "hidden" do %>
                      <button id="sweet-alert-register" class="btn btn-success card-btn-home">Je participe!</button>
                    <% end %>
                  <% end %>
                  <!-- end of Button -->

                  <!-- Bookmark -->
                  <% if user_signed_in? %>
                    <% if current_user.liked? event %>
                      <%= link_to unlike_dashboard_event_path(event), class:"unlike-event bookmark-like-red", method: :put, remote: true do %>
                        <i class="fas fa-bookmark" id="unlike"></i>
                      <% end %>
                    <% else %>
                      <%= link_to like_dashboard_event_path(event), class: "interested bookmark-like-red", method: :put, remote: true do %>
                        <i class="far fa-bookmark" id="like-event"></i>
                      <% end %>
                    <% end  %>
                  <% end %>
                  <!-- End of Bookmark -->

                </div>
              </div>
            </div>
          </div>
          <% j += 1 %>
        <% end %>

      </div>
      <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="sr-only">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="sr-only">Next</span>
      </a>
    </div>
    <!-- end of bootstrap carousel -->

<!-- Matt - section to be deleted when carousel works -->
<!-- yizhu create 3 cards to show the lastest 3 events registed under the banner, in form of card -->
<div class="container event-cards mt-3" id="event-recos">
  <h3 class="my-4">Un peu d'inspiration üí≠</h3>

  <div class="row justify-content-around">
    <% @events.each do |event| %>
      <div class="card card-event-home" style="width: 18rem;">
        <%= cl_image_tag event.photo.key, alt: "event photo", height: 200, crop: :fill %>
        <div class="bookmark-like-red">
          <% if user_signed_in? %>
            <% if current_user.liked? event %>
              <%= link_to unlike_home_event_path(event), class: "unlike-event", remote: true, method: :put do %>
                <i class="fas fa-bookmark" id="unlike"></i>
              <% end %>
            <% else %>
              <%= link_to like_home_event_path(event), class: "interested", remote: true, method: :put do %>
                <i class="far fa-bookmark" id="like-event"></i>
                <div class="infobulle" style="display: none;">
                  <div class="infobulle-texte" id="Int√©ress√©" >
                    Int√©ress√©(e)
                  </div>
                </div>
              <% end %>
            <% end %>
            <% else %>
              <%= link_to new_user_session_path, class: "interested" do %>
                <i class="far fa-bookmark" id="like-event"></i>
              <% end %>
          <% end  %>
        </div>

        <!-- follow button Ilana -->
        <div class="follow-me">
          <% if user_signed_in?  %>
            <% if current_user.liked? event.ngo %>
              <%= link_to unfollow_ngo_path(event.ngo.id), class: "unfollow-ngo", remote: :true, method: :put do %>
                <i class="fas fa-heart" id="unlike"></i>
              <% end %>
            <% else %>
              <%= link_to follow_ngo_path(event.ngo.id), class: "follow-ngo", remote: :true, method: :put do %>
                <i class="far fa-heart" id="like-ngo"></i>
              <% end %>
            <% end  %>
          <% else %>
              <%= link_to new_user_session_path, class: "follow-ngo" do %>
                <i class="far fa-heart" id="like-ngo"></i>
              <% end %>
          <% end %>
        </div>
      <!-- end of follow-button -->

        <div class="card-body">
          <h5 class="card-title"><%= event.name %></h5>
          <p class="card-text "><%= event.description.truncate_words(20) %></p>
          <p class="card-address"><i class="fas fa-map-marker-alt"></i> <%= event.address %></p>
          <p class="card-address"><i class="far fa-calendar-alt"></i><% if event.start_date.to_date == event.end_date.to_date %>
          <%= I18n.l(event.start_date, locale: :fr) %> - <%= I18n.l event.end_date, locale: :fr, format: :hours %>
          <% else %>
          <%= I18n.l(event.start_date, locale: :fr) %> - <%= I18n.l(event.end_date, locale: :fr) %>
          <% end %>
          </p>
          <p class="card-address"><i class="fas fa-user-circle"></i> Places disponibles : <%= event.seats_left %></p>
          <%= link_to "D√©tails", event_path(event), class:"btn btn-success btn-green" %>
        </div>
      </div>
    <% end %>
    </div>
<!-- Matt - end of section to be deleted when carousel works -->

  </div>
